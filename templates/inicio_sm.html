<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Siembra+ | Inicio de recomendaciones</title>
  <meta name="description" content="Plataforma inteligente que combina datos climáticos para apoyar a los productores en la toma de decisiones agrícolas." />

  <link rel="icon" type="image/svg" href="{{ url_for('static', filename='img/ISN.svg') }}">


  <!-- CSS desde /static -->
  <link rel="stylesheet" href="{{ url_for('static', filename='globals.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='styleguide.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='inicio_style.css') }}" />
</head>

<body>
  <div class="INICIO-SM">
    <div class="div">
      <div class="overlap">
        <main class="MARCO-PRINCIPAL">
          <section class="MARCO-MAIN">
            <div class="MAIN-l">
              <div class="MAIN-l-2">
                <img class="ICON" src="{{ url_for('static', filename='img/ICON-01.svg') }}" alt="Icono de recomendaciones de siembra" />
                <div class="TEXT">
                  <h1 class="text-wrapper">Recomendaciones de siembra</h1>
                  <p class="p">
                    Por favor, seleccione su estado o municipio y luego haga clic en Generar, o elija la opción Ubicarme
                    para detectar su ubicación automáticamente y así poder brindarle la recomendación más adecuada.
                  </p>
                </div>
              </div>

              <!-- FORMULARIO (Flask) -->
              <form class="div-2" role="form" aria-label="Formulario de selección de ubicación" method="POST" action="{{ url_for('generar') }}">
                <div class="div-3">
                  <!-- RUTA: Estados / Municipios -->
                  <div class="BOTON-SELECCION" style="width:auto;">
                    <label class="text-wrapper-2" style="margin-right:10px;">Ubicación</label>
                    <label><input type="radio" name="ruta" value="Estados" {% if ruta_sel=='Estados' %}checked{% endif %}> Estados</label>
                    <label style="margin-left:10px;"><input type="radio" name="ruta" value="Municipios" {% if ruta_sel=='Municipios' %}checked{% endif %}> Municipios</label>
                  </div>

                  <!-- ESTADO -->
                  <div class="BOTON-SELECCION" style="width:160px;">

                    <select name="estado" id="estado" aria-label="Elegir estado" style="width:100%;background:transparent;border:none;outline:none;">
                      <option value="">Seleccione un estado</option>
                      {% for e in estados %}
                        {% set c = coordenadas.get(e) %}
                        <option
                          value="{{ e }}"
                          {% if estado_sel==e %}selected{% endif %}
                          data-lat="{{ c[0] if c else '' }}"
                          data-lng="{{ c[1] if c else '' }}"
                        >{{ e }}</option>
                      {% endfor %}
                    </select>

                    <div class="chevron-down" aria-hidden="true">
                      <img class="icon" src="{{ url_for('static', filename='img/icon-2.svg') }}" alt="" />
                    </div>
                  </div>

                  <!-- MUNICIPIO -->
                  <div class="BOTON-SELECCION" style="width:160px;">

                    <select name="municipio" id="municipio" aria-label="Elegir municipio" style="width:100%;background:transparent;border:none;outline:none;">
                      <option value="">Elegir municipio</option>
                      {% for m in municipios %}
                        {% set c = coordenadas_municipios.get(m) %}
                        <option
                          value="{{ m }}"
                          {% if municipio_sel==m %}selected{% endif %}
                          data-lat="{{ c[0] if c else '' }}"
                          data-lng="{{ c[1] if c else '' }}"
                        >{{ m }}</option>
                      {% endfor %}
                    </select>


                    <div class="chevron-down" aria-hidden="true">
                      <img class="icon" src="{{ url_for('static', filename='img/icon-3.svg') }}" alt="" />
                    </div>
                  </div>

                  <!-- UBICARME -->

                </div>

                <!-- MES / AÑO -->
                <div class="div-3">
                    <div class="BOTON-SELECCION" style="width:210px;">
                    <select name="mes" id="mes" aria-label="Selecciona un mes" style="width:100%;background:transparent;border:none;outline:none;">
                      {% for m in meses %}  {# meses ya NO incluye "Todos" #}
                        <option value="{{ m }}" {% if mes_sel==m %}selected{% endif %}>{{ m }}</option>
                      {% endfor %}
                    </select>
                  </div>

                  <div class="BOTON-SELECCION" style="width:210px;">
                    <select name="anio" id="anio" aria-label="Selecciona un año" style="width:100%;background:transparent;border:none;outline:none;">
                      {% for a in anios %}
                        <option value="{{ a }}" {% if anio_sel==a %}selected{% endif %}>{{ a }}</option>
                      {% endfor %}
                    </select>
                  </div>

                  <button type="button" id="btn-ubicarme" class="BOTON-UBICARME" aria-label="Detectar ubicación automáticamente">
                    <img class="img" src="{{ url_for('static', filename='img/icon-ubicarme.svg') }}" alt="" aria-hidden="true" />
                    <span class="text-wrapper-3">Ubicarme</span>
                  </button>


                </div>

                <!-- GENERAR -->
                <button type="submit" class="div-4" aria-label="Generar recomendaciones de siembra">
                  <img class="icon-2" src="{{ url_for('static', filename='img/icon-generar.svg') }}" alt="" aria-hidden="true" />
                  <span class="text-wrapper-4">Generar</span>
                </button>
              </form>

              <!-- TARJETAS DE RESULTADO CLIMÁTICO -->
              <section class="div-2" aria-label="Información climática (predicción)">
                <div class="div-3">
                  <div class="INFO-PRECIPITACION">
                    <div class="ICON-2" aria-hidden="true">
                      <img class="ICON-LLUVIA" src="{{ url_for('static', filename='img/ICON_LLUVIA.svg') }}" alt="" />
                    </div>
                    <div class="TEXT-2">
                      <div class="div-wrapper"><span class="text-wrapper-5">{{ precipitacion if precipitacion is not none else "—" }}{% if precipitacion is not none %} mm{% endif %}</span></div>
                      <div class="div-wrapper"><span class="text-wrapper-6">Precipitación</span></div>
                    </div>
                  </div>

                  <div class="INFO-HUMEDAD">
                    <div class="ICON-2" aria-hidden="true">
                      <img class="ICON-HUMED" src="{{ url_for('static', filename='img/ICON_HUMED.svg') }}" alt="" />
                    </div>
                    <div class="TEXT-2">
                      <div class="div-wrapper"><span class="text-wrapper-5">{{ humedad if humedad is not none else "—" }}{% if humedad is not none %} %{% endif %}</span></div>
                      <div class="div-wrapper"><span class="text-wrapper-6">Humedad relativa</span></div>
                    </div>
                  </div>
                </div>

                <div class="div-3">
                  <div class="div-5">
                    <div class="ICON-2" aria-hidden="true">
                      <img class="ICON-TEMMAX" src="{{ url_for('static', filename='img/ICON_TEMMAX.svg') }}" alt="" />
                    </div>
                    <div class="TEXT-2">
                      <div class="div-wrapper"><span class="text-wrapper-5">{{ temp_max if temp_max is not none else "—" }}{% if temp_max is not none %} °C{% endif %}</span></div>
                      <div class="div-wrapper"><span class="text-wrapper-6">Temperatura máxima</span></div>
                    </div>
                  </div>

                  <div class="div-5">
                    <div class="ICON-2" aria-hidden="true">
                      <img class="ICON-TEMPROM" src="{{ url_for('static', filename='img/ICON_TEMPROM.svg') }}" alt="" />
                    </div>
                    <div class="TEXT-2">
                      <div class="div-wrapper"><span class="text-wrapper-5">{{ temp_media if temp_media is not none else "—" }}{% if temp_media is not none %} °C{% endif %}</span></div>
                      <div class="div-wrapper"><span class="text-wrapper-6">Temperatura media</span></div>
                    </div>
                  </div>

                  <div class="div-5">
                    <div class="ICON-2" aria-hidden="true">
                      <img class="ICON-TEMMIN" src="{{ url_for('static', filename='img/ICON_TEMMIN.svg') }}" alt="" />
                    </div>
                    <div class="TEXT-2">
                      <div class="div-wrapper"><span class="text-wrapper-5">{{ temp_min if temp_min is not none else "—" }}{% if temp_min is not none %} °C{% endif %}</span></div>
                      <div class="div-wrapper"><span class="text-wrapper-6">Temperatura mínima</span></div>
                    </div>
                  </div>
                </div>
                {% if nombre_mes %}
                  <div class="div-3" style="justify-content:center;">
                    <div class="text-wrapper-6">Mes: {{ nombre_mes }} · Año: {{ anio_sel }}</div>
                  </div>
                {% endif %}
              </section>
            </div>

            <aside class="MAIN-r">
              <div class="MARCO-MAIN-r-2">
                <time id="reloj" class="text-wrapper-5" datetime="{{ fecha_hora }}">{{ fecha_hora }}</time>
                <div class="text-wrapper-6">Monitoreo tiempo real</div>
              </div>

              <script>
                function actualizarReloj() {
                  const ahora = new Date();
                  const fechaHora = ahora.toLocaleString("es-MX", {
                    day: "2-digit", month: "2-digit", year: "numeric",
                    hour: "2-digit", minute: "2-digit", second: "2-digit"
                  });
                  document.getElementById("reloj").textContent = fechaHora;
                  document.getElementById("reloj").setAttribute("datetime", fechaHora);
                }
                setInterval(actualizarReloj, 1000);
                actualizarReloj(); // inicial
              </script>

              <iframe
                id="mapFrame"
                class="MAP"
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d12037.618434200173!2d-99.133208!3d19.432607!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x85d1f92a6b8b6cdd%3A0x5405c89bdbf2fbb1!2sCentro%20Hist%C3%B3rico%20de%20la%20Ciudad%20de%20M%C3%A9xico!5e0!3m2!1ses!2smx!4v1694012345678!5m2!1ses!2smx"
                allowfullscreen=""
                loading="lazy"
                referrerpolicy="no-referrer-when-downgrade"
                aria-label="Mapa interactivo de la región seleccionada">
              </iframe>

            </aside>
          </section>

          <section class="INFO-MID">
            <img class="ILLU" src="{{ url_for('static', filename='img/ILLU.svg') }}" alt="Ilustración de Siembra+" />
            <div class="TEXT-3">
              <h2 class="text-wrapper-7">Siembra +</h2>
              <p class="siembra-es-una">
                Siembra+ es una plataforma inteligente que combina datos climáticos, edafológicos y modelos predictivos
                para apoyar a los productores en la toma de decisiones agrícolas. Su objetivo es indicar el mejor momento
                para sembrar y cosechar, considerando factores como lluvia, temperatura, humedad y tipo de suelo.
                <br /><br />
                Queremos dar recomendaciones de siembra porque ayudan a mejorar el rendimiento de los cultivos, reducir
                riesgos por cambios climáticos, optimizar recursos y garantizar una producción más sostenible y rentable
                para los agricultores.
              </p>
            </div>
          </section>

          <!-- RECOMENDACIONES (dinámico) -->
          <section class="RECOMENDACION" id="recom-section">
              <div class="TEXT-4">
                <h2 class="text-wrapper">Resultados del análisis</h2>
                <p class="p">
                  De acuerdo con los datos de tu zona, he preparado una lista de los cultivos que mejor se adaptan, ordenados por la probabilidad de éxito.
                </p>
              </div>

              <div class="recom-container">
                  {% if recomendaciones and recomendaciones|length > 0 %}
                      <div class="recom-slider">
                          <div class="recom-pages-wrapper">
                              {% for rec in recomendaciones %}
                                  {% if loop.index0 % 4 == 0 %}
                                      <div class="recom-page" data-page="{{ loop.index0 // 4 }}">
                                          <div class="recom-grid">
                                  {% endif %}
                                              <div class="recom-card">
                                                  <img class="recom-card-img" src="{{ url_for('static', filename='img/cultivos/' + rec.img_slug + '.png') }}" alt="Imagen de {{ rec.cultivo }}">
                                                  <div class="recom-card-body">
                                                      <div class="recom-card-header">
                                                          <h3 class="recom-card-title">{{ rec.cultivo }}</h3>
                                                          {% if rec.prob is not none %}
                                                              {% set prob_class = 'baja' %}
                                                              {% if rec.prob >= 70 %}{% set prob_class = 'alta' %}{% elif rec.prob >= 40 %}{% set prob_class = 'media' %}{% endif %}
                                                              <span class="prob-badge {{ prob_class }}">{{ rec.prob }}%</span>
                                                          {% endif %}
                                                      </div>
                                                      <p class="recom-card-text">{{ rec.texto }}</p>
                                                  </div>
                                              </div>
                                  {% if (loop.index0 % 4 == 3) or loop.last %}
                                          </div>
                                      </div>
                                  {% endif %}
                              {% endfor %}
                          </div>
                      </div>

                      {% if recomendaciones|length > 4 %}
                          <button class="recom-nav prev" aria-label="Anterior">&lt;</button>
                          <button class="recom-nav next" aria-label="Siguiente">&gt;</button>
                          <div class="recom-dots"></div>
                      {% endif %}

                  {% else %}
                      <!-- Mensaje cuando no hay resultados -->
                      <div class="recom-no-results">
                          <p>Selecciona una ubicación y presiona "Generar" para ver las recomendaciones.</p>
                      </div>
                  {% endif %}
              </div>
          </section>

          <footer class="FOOTER">
            <p class="text-wrapper-10">© 2025 Siembra+. Todos los derechos reservados.</p>
            <p class="text-wrapper-11">
              Siembra+ te ayuda a tomar decisiones inteligentes para tu cultivo, ofreciendo recomendaciones basadas en
              temperatura, humedad y precipitación de tu zona.
            </p>
          </footer>
        </main>

        <header class="HEADER">
          <img class="LOGO" src="{{ url_for('static', filename='img/LOGO.svg') }}" alt="Logo de Siembra+" />
          <nav class="NAV" role="navigation" aria-label="Navegación principal">
            <a href="{{ url_for('home') }}" class="title-wrapper"><span class="title">Inicio</span></a>
            <a href="#" class="title-wrapper"><span class="title">Reporte</span></a>
            <a href="#" class="title-wrapper"><span class="title">Dispositivo de monitoreo</span></a>
            <a href="#" class="title-wrapper"><span class="title">Sobre nosotros</span></a>
          </nav>
        </header>
      </div>

      <button type="button" class="ICON-SIEMBRABOT" aria-label="Activar SiembraBot - Asistente de voz">
        <div class="frame-2">
          <span class="text-wrapper-12">SiembraBot</span>
          <p class="text-wrapper-13">Presiona aquí para usar el asistente de voz.</p>
        </div>
        <img class="capa" src="{{ url_for('static', filename='img/SB.svg') }}" alt="" aria-hidden="true" />
      </button>
    </div>
  </div>

  <!-- JS separado -->
  <script src="{{ url_for('static', filename='js/inicio.js') }}"></script>
  

</body>
</html>
